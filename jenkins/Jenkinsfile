pipeline {
    agent any

     tools {
        // Define Maven tool with the name configured in Jenkins
        maven 'Maven 3.9.8'
    }

    environment {
        TOMCAT_CREDENTIALS = credentials('tomcatcred') // Replace with your credentials ID
    }

    stages {
        stage("Checkout code") {
            steps {
                checkout scm
            }
        }

        stage("Build") {
            steps {
                sh "mvn clean install -Dmaven.test.skip=true"
            }
        }

        stage("Archive Artifact") {
            steps {
                archiveArtifacts artifacts: "target/*.war"
            }
        }

        stage("Deployment") {
            steps {
                script {
                    def tomcatUrl = 'http://3.111.217.149:8080/'
                    def credentialsId = 'tomcatcred'
                    def warFile = findFiles(glob: 'target/*.war')[0].name

                    deploy adapters: [tomcat9(credentialsId: credentialsId, url: tomcatUrl)],
                           war: warFile,
                           contextPath: 'app'
                }
            }
        }

        stage("Notification") {
            steps {
                emailext subject: "Job Completed",
                         body: "Jenkins pipeline job for Maven build completed successfully.",
                         to: "simbathecat657@gmail.com"
            }
        }
    }

    post {
        success {
            echo 'CI/CD Pipeline job successfully built, deployed, and notified.'
        }
        failure {
            echo 'CI/CD Pipeline job failed.'
        }
    }
}
